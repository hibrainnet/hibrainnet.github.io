<h1 id="1-연구노트">1. 연구노트</h1>

<blockquote>
  <p>이미지를 클라우드에 올려 url을 가져오는 이미지 호스팅 작업을 진행</p>

  <p>사용자가 원하는 이미지 파일을 올리면 호스팅 된 이미지 url을 반환</p>

  <p>Cloudinary 클라우드와 ruby언어를 사용하여 구축</p>
</blockquote>

<p><br /></p>

<h3 id="1-1-cloudinary-api">1-1. Cloudinary API</h3>

<ul>
  <li>클라우드 기반의 이미지 관리 솔루션</li>
  <li>이미지 업로드뿐만 아니라 그와 관련된 태그,  이름변경 등의 옵션을 두어 여러가지 기능을 제공</li>
  <li>Rails, PHP, .NET, Java, Django, Javascript(jQuery, Node.js, React, Angular), IOS, Android, Scala 등의 언어를 지원</li>
  <li>이미지 뿐만 아니라 비디오와 API도 제공</li>
</ul>

<p><img src="http://res.cloudinary.com/degxeqfok/image/upload/v1513749352/mb6cqv2ntfmqh2c3n2ph.png" alt="1" /></p>

<p><a href="https://cloudinary.com/documentation">Cloudinary 사이트</a>에서 Ruby on Rails를 참고하여 구축</p>

<p><br /></p>

<h3 id="1-2-ruby-on-rails">1-2. Ruby on Rails</h3>

<ul>
  <li>루비로 작성 된 MVC패턴을 이용하는 오픈 소스 웹 프레임워크</li>
  <li>rails는 트위터, github, airbnb 등 여러 회사에서 사용 중</li>
</ul>

<p><strong>간략한 문법</strong></p>

<p><a href="https://www.ruby-lang.org/ko/">Ruby on Rails 사이트 참조</a></p>

<p><br /></p>

<h3 id="1-3-cloudinary--ruby-이미지-호스팅-url-가져오기">1-3. Cloudinary + Ruby 이미지 호스팅 URL 가져오기</h3>

<p><strong>준비사항</strong></p>

<ul>
  <li>Cloudinary 계정</li>
  <li>Ruby</li>
</ul>

<p><br /></p>

<h4 id="1-3-1-cloudinary-계정생성-및-key값-확인">1-3-1. Cloudinary 계정생성 및 key값 확인</h4>

<p><img src="http://res.cloudinary.com/degxeqfok/image/upload/v1513750419/s7hrkueeap0qj5p23wcj.png" alt="2" /></p>

<p><a href="https://cloudinary.com/">Cloudinary 사이트</a>에 접속하여 SIGN UP FOR FREE 버튼을 눌러 계정을 생성</p>

<p><br /></p>

<p><img src="http://res.cloudinary.com/degxeqfok/image/upload/v1513750686/henzwdap4teiavvmxpv8.jpg" alt="3" /></p>

<p>생성한 계정으로 로그인하여 Media Library탭에 들어가면 위와 같은 저장소가 보임</p>

<p>최초 로그인 시 sample 이미지가 보이며, 오른쪽 상단에는 사용자의 cloud이름과 사용자 이름이 보임</p>

<p><br /></p>

<p><img src="http://res.cloudinary.com/degxeqfok/image/upload/v1513751010/pbvi2kq6hjosjjurnzxp.png" alt="4" /></p>

<p>화면에서 Setting -&gt; Security -&gt; Access 로 들어가면 API Key와 API Secret값을 볼 수 있음</p>

<p>default로 상태는 활성화(Active)로 설정된 것을 확인</p>

<p>API Secret값은 ‘‘***'’로 처리된 부분을 클릭하면 값이 보임</p>

<p><br /></p>

<h4 id="1-3-2-ruby언어로-cloudinary-file-upload-api사용하기">1-3-2. ruby언어로 Cloudinary file upload API사용하기</h4>

<pre><code>gem install cloudinary</code></pre>

<p>cloudinary를 사용하기 위해서 ruby gem으로 설치</p>

<p><br /></p>

<pre><code>require 'cloudinary'

Cloudinary.config do |config|
  config.cloud_name = 'cloud_name'
  config.api_key = '*******************'
  config.api_secret = '*************'
end</code></pre>

<p>cloudinary를 import시켜 준 후 1-3-1에서 확인했던 API Key와 API Secret값을 넣어줌</p>

<p>clound_name에는 오른쪽 상단에 위치한 이름을 넣어줌(기본값 : degxeqfok)</p>

<p>위의 설정은 ruby코드 파일 내에서 해주는 방법이며, yml파일을 이용한 방법은 <a href="https://cloudinary.com/documentation/rails_integration#rails_getting_started_guide">yml파일 설정</a>을 참조</p>

<p><br /></p>

<pre><code>image_path = ARGV

result = Cloudinary::Uploader.upload(image_path[0])		//cloudinary로 upload

url = result['url']		//결과값에서 url와 파일이름 추출
file_name = result['original_filename']

puts "<pre> ![#{file_name}](#{url})</pre>"		//호스팅 된 url결과값 출력

</code></pre>

<p>image_path는 shell에서 입력한 이미지 경로를 매개변수로 받아옴</p>

<p>실제 Cloudinary에 이미지를 입로드 한 후 성공한 *결과값을 받아옴</p>

<p>호스팅 된 URL와 파일이름을 가지고와서 markdown이미지 문법 결과값을 출력</p>

<p><br /></p>

<p><strong>*결과값 result는 다음과 같은 값을 return</strong>	<img src="http://res.cloudinary.com/degxeqfok/image/upload/v1513751879/nokvprh1y1gksdufshzr.png" alt="5" /></p>

<table>
  <thead>
    <tr>
      <th style="text-align: center">구분</th>
      <th style="text-align: center">설명</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: center">url</td>
      <td style="text-align: center">호스팅 URL</td>
    </tr>
    <tr>
      <td style="text-align: center">secure_url</td>
      <td style="text-align: center"> </td>
    </tr>
    <tr>
      <td style="text-align: center">public_id</td>
      <td style="text-align: center">업로드 된 이미지에 접근하는데 필요한 식별자(사용자가 지정 가능)</td>
    </tr>
    <tr>
      <td style="text-align: center">version</td>
      <td style="text-align: center">이미지를 변환할 때 이용한 프로그램 버전(Aspose 문서 변환)</td>
    </tr>
    <tr>
      <td style="text-align: center">format</td>
      <td style="text-align: center">이미지 확장자</td>
    </tr>
    <tr>
      <td style="text-align: center">width</td>
      <td style="text-align: center">이미지 넓이</td>
    </tr>
    <tr>
      <td style="text-align: center">height</td>
      <td style="text-align: center">이미지 높이</td>
    </tr>
    <tr>
      <td style="text-align: center">bytes</td>
      <td style="text-align: center">이미지 크기</td>
    </tr>
  </tbody>
</table>

<p><br /></p>

<p><img src="http://res.cloudinary.com/degxeqfok/image/upload/v1513757344/wlgzte0gt5r6fo4pqiup.png" alt="2" /></p>

<pre><code>

ruby cloudinary-upload.rb 로컬이미지경로

</code></pre>

<p>위의 명령어를 치면 결과값으로 호스팅 된 이미지 url이 나오는 것을 확인</p>

<h3 id="2-참고자료">2. 참고자료</h3>

<ol>
  <li>
    <p>https://www.ruby-lang.org/ko/, ruby-korea, accessed 2017-12-20</p>
  </li>
  <li>
    <p>https://cloudinary.com/documentation/rails_integration#rails_getting_started_guide, cloudinary, accessed 2017-12-20</p>

    <p>​</p>
  </li>
</ol>
